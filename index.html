<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Colleague</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  margin: 0;
  padding: 15px;
}
.app {
  max-width: 550px;
  margin: auto;
  background: white;
  padding: 15px;
  border-radius: 8px;
}
h1 { text-align:center; }
select, input, button {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
}
button {
  background: black;
  color: white;
  border: none;
}
li {
  list-style: none;
  border-bottom: 1px solid #ddd;
  padding: 8px 0;
}
.small { font-size: 13px; color:#555; }
#revisionBox {
  background:#fafafa;
  padding:10px;
  margin-top:10px;
  display:none;
}
</style>
</head>

<body>
<div class="app">
<h1>Colleague</h1>

<div>üî• Streak: <span id="streakCount">0</span> days</div>

<select id="mode">
  <option value="en-en">English ‚Üí English</option>
  <option value="en-hi">English ‚Üí Hindi</option>
</select>

<select id="level">
  <option value="easy">Easy</option>
  <option value="medium">Medium</option>
  <option value="hard">Hard</option>
</select>

<select id="job">
  <option value="all">General</option>
  <option value="software">Software</option>
  <option value="sales">Sales</option>
  <option value="hr">HR</option>
</select>

<input id="wordInput" placeholder="Enter a word">
<button onclick="saveWord()">Save Word</button>

<button onclick="startRevision()">Start Revision</button>
<button onclick="exportWords()">Export</button>

<select id="filterLevel" onchange="renderWords()">
  <option value="all">All Levels</option>
  <option value="easy">Easy</option>
  <option value="medium">Medium</option>
  <option value="hard">Hard</option>
</select>

<ul id="wordList"></ul>

<div id="dashboard"></div>

<div id="revisionBox">
  <h3 id="revWord"></h3>
  <div id="revMeaning" style="display:none;"></div>
  <div id="revExample" style="display:none;"></div>
  <button onclick="showMeaning()">Show Meaning</button>
  <button onclick="markKnown()">I Know</button>
  <button onclick="markRepeat()">Repeat</button>
</div>

</div>

<script>
/* ---------- UTIL ---------- */
function getWords(){return JSON.parse(localStorage.getItem("words"))||[]}
function saveWords(w){localStorage.setItem("words",JSON.stringify(w))}

/* ---------- FETCH ---------- */
async function fetchEnglish(word){
  try{
    const r=await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
    const d=await r.json();
    const def=d[0].meanings[0].definitions[0];
    return {m:def.definition,e:def.example||""};
  }catch{return {m:"Meaning not found",e:""}}
}
async function fetchHindi(text){
  try{
    const r=await fetch(`https://api.mymemory.translated.net/get?q=${text}&langpair=en|hi`);
    const d=await r.json();
    return d.responseData.translatedText;
  }catch{return "‡§Ö‡§∞‡•ç‡§• ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ"}
}

/* ---------- AUDIO ---------- */
function speak(t){
  let u=new SpeechSynthesisUtterance(t);
  u.lang="en-US";speechSynthesis.speak(u);
}

/* ---------- SAVE ---------- */
async function saveWord(){
  const word=wordInput.value.toLowerCase().trim();
  if(!word)return;
  let words=getWords();
  if(words.find(w=>w.word===word))return;

  const en=await fetchEnglish(word);
  let hi="";
  if(mode.value==="en-hi")hi=await fetchHindi(en.m);

  words.push({
    word,
    level:level.value,
    job:job.value,
    en:en.m,
    hi,
    ex:en.e
  });
  saveWords(words);
  wordInput.value="";
  renderWords();
}

/* ---------- RENDER ---------- */
function renderWords(){
  const list=wordList;list.innerHTML="";
  const fl=filterLevel.value;
  getWords().filter(w=>fl==="all"||w.level===fl).forEach(w=>{
    const m=mode.value==="en-en"?w.en:(w.hi||"‡§Ö‡§∞‡•ç‡§• ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ");
    const li=document.createElement("li");
    li.innerHTML=`<b>${w.word}</b> (${w.level}, ${w.job})<br>
    <span class="small">${m}</span><br>
    <span class="small">${w.ex}</span><br>
    <button onclick="speak('${w.word}')">üîä</button>`;
    list.appendChild(li);
  });
  renderDashboard();
}

/* ---------- DASHBOARD ---------- */
function renderDashboard(){
  const w=getWords();
  dashboard.innerHTML=`üìä Words: ${w.length} |
  Easy:${w.filter(x=>x.level==="easy").length} |
  Medium:${w.filter(x=>x.level==="medium").length} |
  Hard:${w.filter(x=>x.level==="hard").length}`;
}

/* ---------- REVISION ---------- */
let rev=[],i=0;
function startRevision(){
  rev=getWords();if(!rev.length)return;
  i=0;revisionBox.style.display="block";showRev();
}
function showRev(){
  const w=rev[i];
  revWord.innerText=w.word;
  revMeaning.innerText=mode.value==="en-en"?w.en:w.hi;
  revExample.innerText=w.ex;
  revMeaning.style.display="none";
  revExample.style.display="none";
}
function showMeaning(){
  revMeaning.style.display="block";
  revExample.style.display="block";
}
function markKnown(){
  updateStreak();
  i++;if(i>=rev.length){revisionBox.style.display="none";return}
  showRev();
}
function markRepeat(){rev.push(rev[i]);i++;showRev();}

/* ---------- STREAK ---------- */
function getStreak(){return JSON.parse(localStorage.getItem("streak"))||{c:0,d:null}}
function updateStreak(){
  const t=new Date().toDateString();
  let s=getStreak();
  if(s.d===t)return;
  const y=new Date(Date.now()-86400000).toDateString();
  s.c=(s.d===y)?s.c+1:1;
  s.d=t;
  localStorage.setItem("streak",JSON.stringify(s));
  streakCount.innerText=s.c;
}
streakCount.innerText=getStreak().c;

/* ---------- EXPORT ---------- */
function exportWords(){
  let txt="";
  getWords().forEach(w=>txt+=`${w.word}\n${w.en}\n\n`);
  const b=new Blob([txt]);
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="colleague.txt";
  a.click();
}

/* ---------- REMINDER ---------- */
if(Notification.permission!=="granted")
  Notification.requestPermission();
setTimeout(()=>{
  new Notification("Colleague Reminder",{body:"Revise 5 words today"});
},5000);

renderWords();
</script>
</body>
</html>
